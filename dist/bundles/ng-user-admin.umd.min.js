!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/platform-browser"),require("@angular/http"),require("@angular/router"),require("@angular/forms"),require("ngx-bootstrap"),require("rxjs"),require("rxjs/add/operator/map")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/platform-browser","@angular/http","@angular/router","@angular/forms","ngx-bootstrap","rxjs","rxjs/add/operator/map"],t):t((e.ng=e.ng||{},e.ng["ng-user-admin"]=e.ng["ng-user-admin"]||{}),e.ng.core,e._angular_platformBrowser,e.vendor._angular_http,e._angular_router,e._angular_forms,e.ngxBootstrap,e.rxjs)}(this,function(e,t,r,s,o,n,i,a){"use strict";var u=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},c=function(e,t){return function(r,s){t(r,s,e)}},l=function(){function e(e){this.http=e,this.loginUrl="/ajax/users/authentication/login",this.logoutUrl="/ajax/users/authentication/logout";var t={token:!1};this.token=t&&t.token,this._baseUrl=""}return e.prototype.isLoggedIn=function(){return Boolean(localStorage.getItem("currentUser"))},e.prototype.login=function(e){var t=this,r=JSON.stringify(e),o=new s.Headers({"Content-Type":"application/json"}),n=new s.RequestOptions({headers:o}),i=this._baseUrl+this.loginUrl;return this.http.post(i,r,n).map(function(e){var r=e.json()&&e.json().body.token;return!!r&&(t.token=r,localStorage.setItem("currentUser",JSON.stringify({token:r})),!0)}).catch(function(e){return a.Observable.throw(e.json().error||"Server error")})},e.prototype.logout=function(){this.token=null,localStorage.removeItem("currentUser")},e}();l=u([t.Injectable(),c(0,t.Inject(s.Http))],l);var p=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},h=function(e,t){return function(r,s){t(r,s,e)}},d=function(){function e(e,t){this.http=e,this.authService=t,this.listUrl="/ajax/erdiko/users/admin/list",this.userUrl="/ajax/erdiko/users/admin/retrieve",this.updateUrl="/ajax/erdiko/users/admin/update",this.createUrl="/ajax/erdiko/users/admin/create",this.deleteUrl="/ajax/erdiko/users/admin/delete",this.changePassUrl="/ajax/erdiko/users/admin/changepass",this.userEventUrl="/ajax/erdiko/users/admin/eventlogs",this.dataStore={},this._users$=new a.BehaviorSubject(null),this._total$=new a.BehaviorSubject(null),this._events$=new a.BehaviorSubject(null),this._eventsTotal$=new a.BehaviorSubject(null),this._baseUrl="",window.location&&"localhost"==window.location.hostname&&(this._baseUrl="http://docker.local:8088")}return Object.defineProperty(e.prototype,"users$",{get:function(){return this._users$.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total$",{get:function(){return this._total$.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events$",{get:function(){return this._events$.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventsTotal$",{get:function(){return this._eventsTotal$.asObservable()},enumerable:!0,configurable:!0}),e.prototype._getHeaderOptions=function(){var e=new s.Headers({"Content-Type":"application/json",Authorization:"Bearer "+this.authService.token});return new s.RequestOptions({headers:e})},e.prototype.getUsers=function(e,t,r,s){var o=this,n=this._baseUrl+this.listUrl;e&&(n+="?pagesize="+e),t&&(n+="&page="+t),r&&(n+="&sort="+r),s&&(n+="&direction="+s);var i=this._getHeaderOptions();return this.http.get(n,i).map(function(e){return e.json()}).subscribe(function(e){o.dataStore.users=[],o.dataStore.total=0,1==e.body.success&&(o.dataStore.users=e.body.users.users,o.dataStore.total=e.body.users.total),o._users$.next(o.dataStore.users),o._total$.next(o.dataStore.total)},function(e){console.error("Error retrieving users!",n,e),o._users$.next([]),o._total$.next(0)})},e.prototype.getUser=function(e){var t=this._baseUrl+this.userUrl+"?id="+e,r=this._getHeaderOptions();return this.http.get(t,r).toPromise().then(function(e){return e.json().body.user})},e.prototype.updateUser=function(e){var t=JSON.stringify(e),r=this._getHeaderOptions(),s=this._baseUrl+this.updateUrl;return this.http.post(s,t,r).toPromise().then(function(e){return e.json().body})},e.prototype.createUser=function(e){var t=JSON.stringify(e),r=this._getHeaderOptions(),s=this._baseUrl+this.createUrl;return this.http.post(s,t,r).toPromise().then(function(e){return e.json().body}).catch(this.handleError)},e.prototype.deleteUser=function(e){var t=JSON.stringify({id:e}),r=this._getHeaderOptions(),s=this._baseUrl+this.deleteUrl;return this.http.post(s,t,r).toPromise().then(function(e){return e.json().body}).catch(this.handleError)},e.prototype.changePassword=function(e,t){var r=JSON.stringify({id:e,newpass:t}),s=this._getHeaderOptions(),o=this._baseUrl+this.changePassUrl;return this.http.post(o,r,s).toPromise().then(function(e){return e.json().body}).catch(this.handleError)},e.prototype.getUsersEvents=function(e,t,r,s,o){var n=this,i=this._baseUrl+this.userEventUrl+"?";e&&(i+="user_id="+e+"&"),t&&(i+="pagesize="+t+"&"),r&&(i+="page="+r+"&"),s&&(i+="sort="+s+"&"),o&&(i+="direction="+o);var a=this._getHeaderOptions();return this.http.get(i,a).map(function(e){return e.json()}).subscribe(function(e){n.dataStore.events=[],n.dataStore.eventsTotal=0,1==e.body.success&&(n.dataStore.events=e.body.logs,n.dataStore.eventsTotal=e.body.total),n._events$.next(n.dataStore.events),n._eventsTotal$.next(n.dataStore.eventsTotal)},function(e){console.error("Error retrieving user event logs!",i,e),n._events$.next([]),n._events$.next(0)})},e.prototype.handleError=function(e){return Promise.reject(e.message||e)},e}();d=p([t.Injectable(),h(0,t.Inject(s.Http)),h(1,t.Inject(l))],d);var f=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},g=function(){function e(){this.messageUpdate=new a.Subject,this.messages={login:{success:"You have Successfully logged in","no-password":"Username or Password is invalid","no-access":"You need to login to gain access",error:"An error occurred. Please try again"},logout:{success:"You have Successfully logged out",error:"You have been logged out unexpectedly"},"create-user":{success:"User was successfully created",error:"An error occurred. Please try again"},"edit-user":{success:"User record was successfully updated",error:"An error occurred. Please try again"},"edit-password":{success:"User password successfully updated",error:"An error occurred. Please try again"},"delete-user":{success:"User successfully deleted",error:"An error occured. Please try again"}}}return e.prototype.setMessageType=function(e){switch(e){case"success":return"success";case"warning":return"warning";default:return"danger"}},e.prototype.sendMessage=function(e,t){var r=this.setMessageType(t),s=this.messages[e][t];this.messageUpdate.next({body:s,type:r})},e.prototype.getMessage=function(){return this.messageUpdate.asObservable()},e.prototype.clearMessage=function(){this.messageUpdate.next(null)},e}();g=f([t.Injectable()],g);var v=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},m=function(e,t){return function(r,s){t(r,s,e)}};e.UserListComponent=function(){function e(e,t,r){var s=this;this.route=t,this.router=r,this.currentPage=1,this.pagesize=10,this.pages=[],this.usersService=e,this.wait=!1,this.sortCol="id",this.sortDir="desc",this.users$=this.usersService.users$.subscribe(function(e){return s.users=e}),this.total$=this.usersService.total$.subscribe(function(e){return s.total=e}),this.usersService.total$.subscribe(function(){return s._listUpdated()}),this.selectedUser=!1}return e.prototype.ngOnInit=function(){this._getUsers()},e.prototype.ngOnDestroy=function(){this.users$.unsubscribe(),this.total$.unsubscribe()},e.prototype._getUsers=function(){this.wait=!0,this.usersService.getUsers(this.pagesize,this.currentPage,this.sortCol,this.sortDir)},e.prototype._listUpdated=function(){this.wait=!1,this._setPagination()},e.prototype.getPageCount=function(){return Math.ceil(this.total/this.pagesize)},e.prototype._setPagination=function(){this.pages=[];for(var e=1;e<=this.getPageCount();e++)this.pages.push(e)},e.prototype.clickPage=function(e){this.currentPage=e,this._getUsers()},e.prototype.clickNext=function(){this.currentPage++,this._getUsers()},e.prototype.clickPrev=function(){this.currentPage--,this._getUsers()},e.prototype.sort=function(e){this.sortCol==e?this.sortDir="desc"==this.sortDir?"asc":"desc":this.sortDir="asc",this.sortCol=e,this._getUsers()},e.prototype.clickDelete=function(e){this.selectedUser=e,this.confirmDeleteModal.show()},e.prototype.cancelDelete=function(){this.confirmDeleteModal.hide()},e.prototype.confirmDelete=function(e){var t=this;this.confirmDeleteModal.hide(),this.wait=!0,this.usersService.deleteUser(this.selectedUser).then(function(e){return t._handleResponse(e)}).catch(function(e){return t.error=e})},e.prototype._handleResponse=function(e){this._getUsers(),this.wait=!1,0==e.success&&(this.error=e.error_message)},e}(),v([t.ViewChild("confirmDeleteModal")],e.UserListComponent.prototype,"confirmDeleteModal",void 0),e.UserListComponent=v([t.Component({selector:"erdiko-user-list",templateUrl:"./user-list.component.html"}),m(0,t.Inject(d))],e.UserListComponent);var y=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},b=function(e,t){return function(r,s){t(r,s,e)}};e.UserEventLogComponent=function(){function e(e){var t=this;this.usersService=e,this.userID=null,this.pageSize=10,this.currentPage=1,this.sortCol="id",this.sortDir="desc",this.pages=[],this.events$=this.usersService.events$.subscribe(function(e){return t.events=e}),this.usersService.events$.subscribe(function(){return t.wait=!1}),this.eventsTotal$=this.usersService.eventsTotal$.subscribe(function(e){return t.eventsTotal=e}),this.usersService.eventsTotal$.subscribe(function(){return t._setPages()})}return e.prototype.sort=function(e){this.sortCol!=e&&(this.sortCol=e),this.sortDir="desc"===this.sortDir?"asc":"desc",this._getEvents()},e.prototype._getEvents=function(){this.wait=!0,this.usersService.getUsersEvents(this.userID,this.pageSize,this.currentPage,this.sortCol,this.sortDir)},e.prototype._setPages=function(){this.pages=[];for(var e=1;e<=this.getPageCount();e++)this.pages.push(e)},e.prototype.clickPage=function(e){this.currentPage=e,this._getEvents()},e.prototype.clickPrev=function(){this.currentPage>1&&this.currentPage--,this._getEvents()},e.prototype.clickNext=function(){this.currentPage<this.getPageCount()&&this.currentPage++,this._getEvents()},e.prototype.getPageCount=function(){return Math.ceil(this.eventsTotal/this.pageSize)},e.prototype.ngOnInit=function(){this.userID=this.inputUserId,this._getEvents()},e.prototype.ngOnDestroy=function(){this.events$.unsubscribe(),this.eventsTotal$.unsubscribe()},e}(),y([t.Input()],e.UserEventLogComponent.prototype,"inputUserId",void 0),e.UserEventLogComponent=y([t.Component({selector:"erdiko-user-event-log",templateUrl:"./user-event-log.component.html",providers:[d]}),b(0,t.Inject(d))],e.UserEventLogComponent);var U=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},_=function(e,t){return function(r,s){t(r,s,e)}};e.UsersEventLogComponent=function(){function e(e){var t=this;this.usersService=e,this.userID=null,this.pageSize=10,this.currentPage=1,this.sortCol="id",this.sortDir="desc",this.pages=[],this.events$=this.usersService.events$.subscribe(function(e){return t.events=e}),this.usersService.events$.subscribe(function(){return t.wait=!1}),this.eventsTotal$=this.usersService.eventsTotal$.subscribe(function(e){return t.eventsTotal=e}),this.usersService.eventsTotal$.subscribe(function(){return t._setPages()})}return e.prototype.sort=function(e){this.sortCol!=e&&(this.sortCol=e),this.sortDir="desc"===this.sortDir?"asc":"desc",this._getEvents()},e.prototype._getEvents=function(){this.wait=!0,this.usersService.getUsersEvents(this.userID,this.pageSize,this.currentPage,this.sortCol,this.sortDir)},e.prototype._setPages=function(){this.pages=[];for(var e=1;e<=this.getPageCount();e++)this.pages.push(e)},e.prototype.clickPage=function(e){this.currentPage=e,this._getEvents()},e.prototype.clickPrev=function(){this.currentPage>1&&this.currentPage--,this._getEvents()},e.prototype.clickNext=function(){this.currentPage<this.getPageCount()&&this.currentPage++,this._getEvents()},e.prototype.getPageCount=function(){return Math.ceil(this.eventsTotal/this.pageSize)},e.prototype.ngOnInit=function(){this._getEvents()},e.prototype.ngOnDestroy=function(){this.events$.unsubscribe(),this.eventsTotal$.unsubscribe()},e}(),e.UsersEventLogComponent=U([t.Component({selector:"erdiko-users-event-log",templateUrl:"./users-event-log.component.html",providers:[d]}),_(0,t.Inject(d))],e.UsersEventLogComponent);var P=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},w=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();P([t.Input()],w.prototype,"passwordForm",void 0),w=P([t.Component({selector:"erdiko-password",templateUrl:"./password.component.html"})],w);var j=function(){function e(){}return e}(),S=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},O=function(e,t){return function(r,s){t(r,s,e)}};e.UserEditComponent=function(){function e(e,t,r,s){this.wait=!1,this.passWait=!1,this.usersService=e,this.messageService=s,this.route=t,this.router=r,this.fb=new n.FormBuilder,this.user=new j}return e.prototype.ngOnInit=function(){var e=this;this.route.data.forEach(function(t){void 0!==t.user&&t.user&&(e.user=t.user)}),this._initForms()},e.prototype._initForms=function(){this.passwordForm=this.fb.group({password:["",[n.Validators.required,n.Validators.minLength(3)]],confirm:["",n.Validators.required]}),this.userForm=this.fb.group({name:["",[n.Validators.required,n.Validators.minLength(3)]],email:["",n.Validators.required],role:["",n.Validators.required]}),this.user.id&&(this.userForm.controls.name.setValue(this.user.name),this.userForm.controls.email.setValue(this.user.email),this.userForm.controls.role.setValue(this.user.role.id))},e.prototype.isUserFormValid=function(){if(this.wait)return!1;if(!this.user.id){if(!this.passwordForm.valid)return!1;if(this.passwordForm.controls.password.value!==this.passwordForm.controls.confirm.value)return!1}return this.userForm.valid&&!this.wait},e.prototype.isPassFormValid=function(){return!this.passWait&&(!!this.passwordForm.valid&&this.passwordForm.controls.password.value===this.passwordForm.controls.confirm.value)},e.prototype.onSubmit=function(e){var t=this,r=e.value,s=e.valid;if(this.wait=!0,this.msg=this.error="",s){if(this.user.id)return r.id=this.user.id,this.usersService.updateUser(r).then(function(e){return t._handleResponse(e)}).catch(function(e){return t.error=e});var o={email:r.email,name:r.name,role:r.role,password:this.passwordForm.controls.password.value};return this.usersService.createUser(o).then(function(e){return t._handleResponse(e)}).catch(function(e){return t.error=e})}},e.prototype._handleResponse=function(e){this.wait=!1,1==e.success?(this.messageService.sendMessage("edit-user","success"),"create"===e.method&&(this.router.navigate(["/user/"+e.user.id]),this.messageService.sendMessage("create-user","success"))):this._handleError(e.error_message)},e.prototype.onSubmitChangepass=function(e){var t=this,r=e.value,s=e.valid;if(this.passWait=!0,this.passMsg=this.passError="",s)return this.usersService.changePassword(this.user.id,r.passwordInput.password).then(function(e){return t._handlePasswordResponse(e)}).catch(function(e){return t.passError=e})},e.prototype._handlePasswordResponse=function(e){this.passWait=!1,this.passwordForm.reset(),1==e.success?this.messageService.sendMessage("edit-password","success"):this.passError=e.error_message},e.prototype._handleError=function(e){this.error=e},e.prototype.createEditHeader=function(){return this.user.id?"Edit User":"Create User"},e}(),S([t.ViewChild(w)],e.UserEditComponent.prototype,"passwordComponent",void 0),e.UserEditComponent=S([t.Component({selector:"erdiko-user-edit",providers:[g],templateUrl:"./user-edit.component.html"}),O(0,t.Inject(d)),O(1,t.Inject(o.ActivatedRoute)),O(2,t.Inject(o.Router)),O(3,t.Inject(g))],e.UserEditComponent);var C=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i};e.MessageComponent=function(){function e(e,t){var r=this;this.messageService=e,this.router=t,this.messageSubscription=this.messageService.getMessage().subscribe(function(e){return r.message=e})}return e.prototype.close=function(){this.message=null},e}(),e.MessageComponent=C([t.Component({selector:"erdiko-message",templateUrl:"./message.component.html"})],e.MessageComponent);var E=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},R=[];e.UserAdminModule=$=function(){function e(){}return e.forRoot=function(){return{ngModule:$,providers:[l,d,g]}},e}(),e.UserAdminModule=$=E([t.NgModule({imports:[r.BrowserModule,s.HttpModule,o.RouterModule.forRoot(R),n.FormsModule,n.ReactiveFormsModule,i.AlertModule,i.ModalModule,i.TabsModule],declarations:[e.UserListComponent,e.UserEventLogComponent,e.UsersEventLogComponent,e.UserEditComponent,w,e.MessageComponent],exports:[e.UserListComponent,e.UserEventLogComponent,e.UsersEventLogComponent,e.UserEditComponent,e.MessageComponent],providers:[l,d,g]})],e.UserAdminModule);var $;Object.defineProperty(e,"__esModule",{value:!0})});